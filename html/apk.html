<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>APK Collection</title>

<style>
    /* ====== 变量系统 ====== */
    :root {
        --bg-color: #F2F2F7; /* Apple System Gray 6 */
        --header-bg: rgba(255, 255, 255, 0.75);
        --card-bg: rgba(255, 255, 255, 0.7);
        --text-primary: #000000;
        --text-secondary: #8E8E93;
        --accent: #007AFF;
        --border: rgba(0, 0, 0, 0.05);
        --btn-bg: #FFFFFF;
        --btn-text: #007AFF;
        --shadow: 0 4px 20px rgba(0,0,0,0.05);
        --input-bg: rgba(118, 118, 128, 0.12);
        --gap: 16px;
    }

    html.dark {
        --bg-color: #000000;
        --header-bg: rgba(28, 28, 30, 0.75);
        --card-bg: rgba(28, 28, 30, 0.7);
        --text-primary: #FFFFFF;
        --text-secondary: #98989D;
        --accent: #0A84FF;
        --border: rgba(255, 255, 255, 0.1);
        --btn-bg: #1C1C1E;
        --btn-text: #0A84FF;
        --shadow: 0 4px 20px rgba(0,0,0,0.3);
        --input-bg: rgba(118, 118, 128, 0.24);
    }

    /* ====== 全局重置 ====== */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-primary);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
        padding-bottom: 40px;
        transition: background-color 0.3s ease; /* 给不支持 ViewTransition 的浏览器兜底 */
    }

    /* ====== 顶部导航 (Glassmorphism) ====== */
    header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--header-bg);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border-bottom: 0.5px solid var(--border);
        padding: 12px var(--gap);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    .header-left {
        flex: 1;
        position: relative;
    }

    /* 自绘搜索图标 */
    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        opacity: 0.5;
        fill: var(--text-secondary);
    }

    input {
        width: 100%;
        padding: 10px 12px 10px 36px;
        border-radius: 10px;
        border: none;
        background: var(--input-bg);
        color: var(--text-primary);
        font-size: 16px; /* 防止iOS缩放 */
        outline: none;
        transition: 0.2s;
    }
    input:focus { background: rgba(118, 118, 128, 0.2); }

    /* ====== 主题切换按钮 ====== */
    .theme-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: transparent;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-primary);
        transition: transform 0.2s;
    }
    .theme-btn:active { transform: scale(0.9); }
    
    /* 自绘 SVG 图标样式 */
    .svg-icon {
        width: 24px;
        height: 24px;
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
    }

    /* ====== 内容区域 ====== */
    .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px var(--gap);
        display: grid;
        /* 响应式 Grid：手机一列，平板两列，PC三列 */
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
    }

    /* ====== 卡片设计 ====== */
    .card {
        background: var(--card-bg);
        border-radius: 18px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        position: relative;
        box-shadow: var(--shadow);
        border: 0.5px solid var(--border);
        transition: transform 0.2s;
    }

    .card:active { transform: scale(0.98); }

    .card-main {
        display: flex;
        align-items: center;
        gap: 14px;
    }

    .app-icon {
        width: 60px;
        height: 60px;
        border-radius: 14px;
        object-fit: cover;
        background: #eee;
        border: 0.5px solid rgba(0,0,0,0.1);
        flex-shrink: 0;
    }

    .app-info {
        flex: 1;
        min-width: 0; /* 允许文本截断 */
    }

    .app-name {
        font-size: 17px;
        font-weight: 600;
        margin: 0 0 4px 0;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .app-desc {
        font-size: 13px;
        color: var(--text-secondary);
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* 按钮组 */
    .action-row {
        display: flex;
        gap: 10px;
        margin-top: auto;
    }

    .btn {
        flex: 1;
        padding: 8px 0;
        border-radius: 20px; /* 胶囊形状 */
        background: var(--input-bg);
        color: var(--accent);
        text-decoration: none;
        font-size: 13px;
        font-weight: 600;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        transition: opacity 0.2s;
    }
    .btn:active { opacity: 0.6; }
    
    .btn-primary {
        background: var(--accent);
        color: #fff;
    }

    .btn-icon-svg {
        width: 14px;
        height: 14px;
    }

    /* ====== 底部 ====== */
    .footer-info {
        text-align: center;
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 20px;
        opacity: 0.6;
    }

    /* ====== View Transition 动画核心 (Telegram 效果) ====== */
    ::view-transition-old(root),
    ::view-transition-new(root) {
        animation: none;
        mix-blend-mode: normal;
    }

    /* 针对暗黑模式切换时的 CSS 层级控制 */
    ::view-transition-old(root) { z-index: 1; }
    ::view-transition-new(root) { z-index: 9999; }

    /* ====== 移动端优化 ====== */
    @media (max-width: 600px) {
        .container { grid-template-columns: 1fr; } /* 强制单列 */
        .card { border-radius: 20px; } /* 更大的圆角 */
        .app-icon { width: 64px; height: 64px; }
    }
</style>
</head>
<body>

<header>
    <div class="header-left">
        <svg class="search-icon" viewBox="0 0 24 24">
            <path d="M21 21L16.65 16.65M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
        <input type="text" id="searchInput" placeholder="搜索应用..." />
    </div>
    
    <button class="theme-btn" id="themeToggle" aria-label="切换主题">
        </button>
</header>

<div class="container" id="appGrid">
    </div>

<div class="footer-info" id="statusInfo">加载中...</div>

<script>
    // ====== 数据源 ======
    const apps = [
        {
            name: "CPU-Z",
            desc: "手机各种参数随心看",
            icon: "../apk/img/CPU-Z.png",
            link: "../apk/apk/CPU-Z.apk",
            link2: ""
        },
        {
            name: "Spotify Premium",
            desc: "无损音质，无广告打扰。",
            icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Spotify_logo_without_text.svg/240px-Spotify_logo_without_text.svg.png",
            link: "#dl2"
        },
        {
            name: "VSCO Cam",
            desc: "全滤镜解锁，摄影师必备。",
            icon: "https://upload.wikimedia.org/wikipedia/commons/3/32/VSCO_Seal.svg",
            link: "#dl3",
            link2: ""
        },
        {
            name: "Google Chrome",
            desc: "快速、安全、可自定义的浏览器。",
            icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Google_Chrome_icon_%28February_2022%29.svg/240px-Google_Chrome_icon_%28February_2022%29.svg.png",
            link: "#dl4"
        },
        {
            name: "YouTube Revanced",
            desc: "后台播放，跳过视频广告。",
            icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/YouTube_full-color_icon_%282017%29.svg/240px-YouTube_full-color_icon_%282017%29.svg.png",
            link: "#dl5",
            link2: "#mirror"
        }
    ];

    // ====== 图标 SVG 定义 (自绘) ======
    const Icons = {
        sun: `<svg class="svg-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,
        moon: `<svg class="svg-icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,
        download: `<svg class="btn-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>`,
        link: `<svg class="btn-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`
    };

    // ====== 渲染逻辑 ======
    const grid = document.getElementById('appGrid');
    const statusInfo = document.getElementById('statusInfo');
    const searchInput = document.getElementById('searchInput');

    function render(data) {
        grid.innerHTML = '';
        if (data.length === 0) {
            statusInfo.textContent = "未找到应用";
            return;
        }
        
        data.forEach(app => {
            const hasLink2 = app.link2 && app.link2.trim() !== "";
            // 如果有备用链接，主按钮变小；否则主按钮占满
            const btnHtml = hasLink2 ? 
                `<a href="${app.link}" class="btn btn-primary">
                    ${Icons.download} 获取
                 </a>
                 <a href="${app.link2}" class="btn">
                    ${Icons.link} 备用
                 </a>` :
                `<a href="${app.link}" class="btn btn-primary" style="width:100%">
                    ${Icons.download} 获取
                 </a>`;

            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-main">
                    <img src="${app.icon}" class="app-icon" loading="lazy" alt="icon">
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-desc">${app.desc}</div>
                    </div>
                </div>
                <div class="action-row">
                    ${btnHtml}
                </div>
            `;
            grid.appendChild(card);
        });
        statusInfo.textContent = `${data.length} 个应用`;
    }

    // ====== 搜索 ======
    searchInput.addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        const filtered = apps.filter(app => 
            app.name.toLowerCase().includes(val) || 
            app.desc.toLowerCase().includes(val)
        );
        render(filtered);
    });

    // ====== Telegram 风格主题切换 (核心动画) ======
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;

    // 1. 初始化图标
    function updateThemeIcon() {
        const isDark = html.classList.contains('dark');
        themeToggle.innerHTML = isDark ? Icons.sun : Icons.moon;
    }

    // 检查本地存储
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        html.classList.add('dark');
    }
    updateThemeIcon();

    // 2. 切换逻辑
    themeToggle.addEventListener('click', (event) => {
        // 如果浏览器不支持 View Transitions，直接切换
        if (!document.startViewTransition) {
            toggleTheme();
            return;
        }

        // 获取点击坐标
        const x = event.clientX;
        const y = event.clientY;

        // 计算扩散圆的最大半径 (勾股定理)
        const endRadius = Math.hypot(
            Math.max(x, innerWidth - x),
            Math.max(y, innerHeight - y)
        );

        // 开始视图转换
        const transition = document.startViewTransition(() => {
            toggleTheme();
        });

        // 定义动画
        transition.ready.then(() => {
            const clipPath = [
                `circle(0px at ${x}px ${y}px)`,
                `circle(${endRadius}px at ${x}px ${y}px)`,
            ];
            
            // 决定是谁在动：如果是变黑，黑色圆圈扩散；如果是变亮，亮色圆圈扩散
            // 这里的逻辑是：新视图(View-New) 也是基于 classList 变动后的状态
            document.documentElement.animate(
                {
                    clipPath: clipPath,
                },
                {
                    duration: 500,
                    easing: "ease-in", // 加速扩散，更像 Telegram
                    pseudoElement: "::view-transition-new(root)",
                }
            );
        });
    });

    function toggleTheme() {
        const isDark = html.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateThemeIcon();
    }

    // 初次渲染
    render(apps);
</script>

</body>
</html>
